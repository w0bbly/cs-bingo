def projectVersion = ext.serviceVersion as String
version = projectVersion + (project.hasProperty('versionExtension') ? "${versionExtension}" : '')

task configureBuildProfile {
    if (!project.hasProperty("buildProfile")) {
        project.extensions.add("buildProfile", "local")
    }

    println "configureBuildProfile ${buildProfile}"
}

sourceSets {
    main {
        resources {
            srcDir "conf/$buildProfile"
        }
    }
}

tasks.register('bumpVersion') {
    group = 'jpimentel'
    doLast {
        def (major, minor, patch) = projectVersion.tokenize('.')
        ant.propertyfile(file: 'gradle.properties') {
            entry(key: 'serviceVersion', value: major + '.' + minor + '.' + ((patch as Integer) + 1))
        }
    }
}

tasks.register('printVersion') {
    group = 'jpimentel'
    doLast {
        println projectVersion
    }
}

task buildLocal(type: GradleBuild) {
    group "Build Shortcuts"
    startParameter.excludedTaskNames = gradle.startParameter.excludedTaskNames
    startParameter.projectProperties.putAll(gradle.startParameter.projectProperties)
    startParameter.projectProperties.put("buildProfile", "local")
    tasks = ['build']
}

task buildDev(type: GradleBuild) {
    group "Build Shortcuts"
    startParameter.excludedTaskNames = gradle.startParameter.excludedTaskNames
    startParameter.projectProperties.putAll(gradle.startParameter.projectProperties)
    startParameter.projectProperties.put("buildProfile", "dev")
    tasks = ['clean', 'build']
}